\subsection{机会窗口检测算法}\label{subsec:ow}

0. 设计动机 

我们在解决问题时发现，同一个任务有两种可能的执行方式，一种是在私有云中独自处理的独立任务，另一种是由公有和私有云协同处理的协作任务。我们遇到需要调度两类动态转换的任务的问题。

协作任务是长度为3的线性工作流（LW），调度线性工作流同样可以使用普通DAG工作流调度先排序再调度的方案，使用基于Rank Level（如HEFT）的方法启发式排序，但预先排序会（有什么问题？请举例说明，比如插入问题，应该向线性工作流的空隙中插入多少任务为好？我们的线性工作流是DAG的极端情况、它同时只能允许一个处理、而且不能合并，传统先排序再调度的方案效率低）。或者RoV、SPV、RK编码的元启发式排序，但为每个任务增加一位额外的排序编码会增加搜索空间，影响收敛速度，降低元启发算法的调度规模。

因此我们设计了OW-FF算法，它在元启发算法的目标函数评估阶段被调用，检查私有虚拟机中因为将计算卸载至公有云而产生的空闲时间（本文将这段空闲时间称作“机会窗口”），虚拟机在机会窗口内处理下一个任务，提高私有虚拟机资源利用率。由于OW-FF在元启发式算法的内层迭代循环内运行，因此降低算法复杂度成为难点，我们使用首次适应与限制测试机会窗口次数的方式，将算法时间复杂度控制在O(n)级别，与其他目标函数计算的复杂度一致。



1. **伪代码与复杂度**（算法\ref{alg:ow-fcfs}）  
   - **步骤**：初始化队列 → 拆分协作任务 → 动态插入非关键任务 → 输出$\Pi$。  
   - **时间复杂度**：$O(n)$（$n$为待调度任务数）。  
   - **确定性输出**：唯一调度顺序。  

---

#### **3.3 NSGAII算法与混合编码设计**  
1. **混合编码结构**  
   - **私有云分配**：整数编码$X'_m \in \{1, 2, \dots, S_k\}$，内嵌数据本地化约束（$X'_m \leq S_k$）。  
   - **公有云映射**：全局唯一索引编码$Y'_m \in \{1, \dots, V_{\text{total}}\}$（公式\eqref{eq:pubid-enumeration}）。  
   - **安全策略**：  
     - 数据级策略$Z^\text{enc}_k$：约束关联任务加密一致性。  
     - 卸载决策$Z^{\text{offload}}_m$：0-1变量表示协作/独立执行。  
   - **编码优势**：搜索空间降维50%（对比传统全连接编码）。  

2. **遗传算子设计**  
   - **负载感知变异**：动态调整变异概率：  
     \[
     P_{\text{mut}} = 
     \begin{cases} 
     0.15 \cdot (1 + \frac{U_{\text{priv}}}{C_{\text{priv}}}), & U_{\text{priv}} > 0.8C_{\text{priv}} \\
     0.15 \cdot (1 - \frac{U_{\text{pub}}}{C_{\text{pub}}}), & \text{其他}
     \end{cases}
     \]  
   - **分段交叉**：  
     - 安全策略编码独立交叉（保留数据级一致性）。  
     - 虚拟机分配编码按任务分组交叉。  

3. **约束处理策略**  
   - **硬约束**：通过编码范围限制自动满足（如$X'_m \leq S_k$）。  
   - **软约束修复**：冲突任务策略对齐（概率$p_{\text{repair}}=0.85$）。  

---

#### **3.4 算法收敛性分析**  
1. **时间复杂度**  
   - 主要开销：非支配排序（$O(N \log N)$） + 适应度计算（$O(N \cdot M)$）。  
   - 总复杂度：$O(T_{\max} \cdot (N \log N + N \cdot M))$（$T_{\max}$为迭代次数）。  

2. **空间复杂度**  
   - 种群存储：$O(N)$。  
   - 精英档案：$O(|\mathcal{A}|)$（$|\mathcal{A}| \leq 2N$）。  

---

### **图表与公式引用**  
- **图\ref{fig:mhalg-flow}**：NSGA-OW算法流程图。  
- **算法\ref{alg:ow-fcfs}**：OW-FF伪代码。  
- **公式\eqref{eq:pubid-enumeration}**：公有云虚拟机索引映射规则。  
- **公式\eqref{eq:window-capacity}**：窗口容量计算。