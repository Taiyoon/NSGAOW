# 启发式规则设计
不错，现在我们基本确定了启发式规则的设计方案，请根据下面的思路写出这部分的论文大纲：
1. 本文优化问题的决策变量只有任务卸载与安全策略选择，任务执行模型并不完整，还需要定义任务在虚拟机内部执行顺序。
2. 任务执行顺序有多种确定方式，较好的方案是将任务顺序进行RoV编码，并加入原优化问题，但这会大幅增加求解时间。启发式规则包括截止时间优先，短任务优先等。算法本文选用常用且优秀的FCFS启发式规则（或者叫早到达时间优先）定义任务执行顺序。
3. 由于本文设计的调度场景中，不仅有普通的独立任务，还存在线性工作流建模的协作任务。因此需要扩展原有的FCFS启发式规则，使其能调度协作任务，并证明启发式规则是正确的，可以确定任务执行顺序。因此，本文提出公理：在一台虚拟机中，若一组启发式规则可以确定执行顺序，当且仅当分配到虚拟机的任务集合E_i中的全部任务存在严格全序关系，（或者说具有拓扑排序唯一性）。
4. 不失一般性的，本文认为下标小的任务早于下标大的任务到达，也就是下标小的任务应先于下标大的任务处理；同时对于协作任务，应保证加密子任务早于验证子任务处理。根据以上原则，本文将原始的FCFS启发式规则扩展到调度独立与协作两类混合到达任务的场景中：
   1. **公有云**  
      仍严格按任务下标升序排列：
      \[
      e_{m-1}^{(P)} < e_{m}^{(P)}
      \]
   2. **私有云**  
      所有任务（协作任务的E/V、独立任务）按**任务下标严格升序排列**：
      \[
      \forall i < j, \ e_i^{(X)} < e_j^{(Y)} \quad (X,Y \in \{\text{E, V, 独立任务}\})
      \]
      - **协作任务内部顺序**：
        \[
        e_m^{(\text{E})} < e_m^{(\text{V})}
        \]
5. 根据以上规则，证明公有云和公有云虚拟机中任务之间存在严格全序关系，因此这是一组合理的启发式规则。
**（1）公有云虚拟机**  
所有P部分按任务下标升序排列，严格全序关系显然成立。
**（2）私有云虚拟机**  
分析私有云中所有情况，证明严格全序性：
   1. **跨任务顺序**：  
      对任意两个任务\( e_i^{(X)} \)和\( e_j^{(Y)} \)，若\( i < j \)，则无论其类型（E/V/独立任务），均满足\( e_i^{(X)} < e_j^{(Y)} \)。  
      - **例1**：\( e_{m-1}^{(\text{V})} < e_{m}^{(\text{E})} \)（因\( m-1 < m \)）  
      - **例2**：独立任务\( e_{m-1} < e_{m}^{(\text{E})} \)（因下标顺序）
   2. **任务内顺序**：  
      同一协作任务中，\( e_m^{(\text{E})} < e_m^{(\text{V})} \)，与下标规则一致。
1. 但是通过一些简单的调度例子我们发现，
    - 跨云协作时，私有云将任务计算交给公有云，私有云资源得到空闲，原始的FCFS规则中，私有云在这段时间内是空闲的，资源被浪费。
2. 因此本文需要改进原有FCFS启发式规则，利用这段空闲时间。启发式规则的设计原则是：根据空闲时间的长度，决定是否应该处理下一个任务：若空闲时间足以完成下一个任务，则执行下一个任务，充分利用私有云空闲资源；若不足以完成下一个任务，则等待公有云完成当前任务，降低任务完成时间；改进后的FCFS启发式规则在不增加任务完成时间的前提下，同一时间内可以处理更多任务。
3. 根据以上原则，我们定义改进的FCFS启发式规则：
  - **独立任务（不变）**
    - \( e_{m-1} < e_m \)  
  - **协作任务**：
    - 公有云中（不变）：
      - e_m-1^{\text{(P)}} < e_m-1^{\text{(P)}}
    - 私有云中（放松了启发式规则，允许在空闲时间内调度下一个任务）：
      - e_m^{\text{(E)}} < e_m^{\text{(V)}}
      - e_m-1^{\text{(E)}} < e_m^{\text{(E)}}
      - e_m-1^{\text{(V)}} < e_m^{\text{(V)}}
  - **独立任务和协作任务之间（放松了）**：
    - e_m-1^{\text{(E)}} < e_m
    - e_m-1 < e_m^{\text{(E)}}
  - **下一个任务不应该增加当前任务完成时间（这个公式不够好，还有一些空闲时间没有利用上，同时没有完整定义严格全序关系）**：
    - 根据其现实含义，我们认为如果处理下一个任务不会增加当前任务的完成时间，则可以利用这段空闲时间处理下一个任务，根据这个原则，增加启发式规则：
    \[
        \begin{cases}
            e_m < e_{m-1}^{V}, 当\text{CPUFT}(e_{m-1}^{(E)}) + \frac{\text{size}(e_m)}{A_i} \le \text{NETFT}(e_{m-1}^{V})\\
            e_{m-1}^{V} < e_m ,否则
        \end{cases}
    \]
    (这个规则允许下一个任务利用私有云等待公有云处理当前任务的空闲时间)
4. 根据新增规则，可以证明此时私有云中任务之间存在严格全序关系，因此我们严谨的定义了任务在本混合云系统中的执行顺序，可以作为优化目标。
### 精简版子算法章节大纲（作为主算法的一部分）

---

#### 4. [主算法名称]中的启发式任务排序子算法  
##### 4.1 问题定义与挑战  
- **输入条件**：混合云中已卸载的任务集合（含协作任务子任务、独立任务）  
- **目标**：快速确定虚拟机内任务执行顺序，满足  
  - (1) 协作任务的加密-验证依赖关系  
  - (2) 混合云间协作的时序约束  
  - (3) 最小化求解复杂度  

##### 4.2 启发式规则设计  
- **规则1（基础FCFS扩展）**：  
  - **公有云虚拟机**：严格按下标升序执行（保证确定性）  
    \[
    \text{Order}(e_i^{(P)}, e_j^{(P)}) = \begin{cases} 
    e_i^{(P)} \rightarrow e_j^{(P)}, & \text{if } i < j \\
    \end{cases}
    \]
  - **私有云虚拟机**：  
    - 跨任务：按下标升序，忽略任务类型  
      \[
      \forall i < j, \ e_i^{(X)} \rightarrow e_j^{(Y)} \quad (X,Y \in \{\text{E, V, 独立任务}\})
      \]  
    - 协作任务内部：强制加密先于验证  
      \[
      e_m^{(\text{E})} \rightarrow e_m^{(\text{V})}
      \]  

- **规则2（改进的空闲时间利用）**：  
  - **私有云动态插入策略**：  
    - 若当前任务完成后的空闲时间\( t_{\text{idle}} \geq \text{next task's } t_{\text{exec}} \)，则提前调度后续任务  
    - 否则等待公有云协作任务返回，避免超时  

##### 4.3 正确性分析（核心定理）  
- **定理1（严格全序性）**：  
  - 任务集合在虚拟机内存在唯一拓扑排序  
  - **证明**：  
    - 公有云：下标全序性直接满足  
    - 私有云：  
      1. 任意两任务\( e_i^{(X)}, e_j^{(Y)} \)满足\( i \neq j \Rightarrow \)下标决定顺序  
      2. 协作任务内部\( e_m^{(\text{E})} \rightarrow e_m^{(\text{V})} \)不破坏下标全序性  

##### 4.4 复杂度与优势  
- **时间复杂度**：\( O(n \log n) \)（排序代价，远低于RoV编码的NP-Hard问题）  
- **优势对比**：  
  | 方法               | 协作任务支持 | 复杂度   | 资源利用率  |  
  |--------------------|--------------|----------|-------------|  
  | RoV编码            | ✔️           | 指数级   | 高          |  
  | 原始FCFS           | ❌           | \( O(n) \)| 低          |  
  | **本文启发式规则** | ✔️           | \( O(n \log n) \) | 高（改进后）|  

--- 

### 章节设计说明  
1. **定位清晰**：作为主算法的子模块，聚焦任务顺序的快速决策，不展开全局优化问题细节。  
2. **紧贴需求**：针对混合云协作场景的特殊约束（加密-验证依赖、跨云空闲时间），设计层次化规则。  
3. **轻量证明**：通过严格全序性定理，避免冗长的数学推导，直接服务于主算法可行性。  
4. **量化对比**：通过复杂度与优势表格，直观体现子算法的实用价值。